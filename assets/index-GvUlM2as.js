(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();function d(c){return c?c.replace(/[&<>'"]/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[t]):""}class ${constructor(t,e){this.container=document.getElementById(t),this.storageKey="class-portal-timetable",this.colorStorageKey="class-portal-subject-colors",this.settings=e,this.isEditing=!1,this.data=this.loadData(),this.subjectColors=this.loadColors(),this.palette=["#bfdbfe","#bbf7d0","#fef08a","#fecaca","#ddd6fe","#fed7aa","#cffafe","#fbcfe8","#e5e7eb","#d1fae5"],this.render()}get days(){var t,e;return["月","火","水","木","金","土"].slice(0,((e=(t=this.settings)==null?void 0:t.settings)==null?void 0:e.timetableDays)||5)}get periods(){var e,r;const t=((r=(e=this.settings)==null?void 0:e.settings)==null?void 0:r.timetablePeriods)||6;return Array.from({length:t},(s,a)=>a+1)}get periodTimes(){var t,e;return((e=(t=this.settings)==null?void 0:t.settings)==null?void 0:e.periodTimes)||[]}get showTimes(){var t,e;return((e=(t=this.settings)==null?void 0:t.settings)==null?void 0:e.showPeriodTimes)||!1}loadData(){const t=localStorage.getItem(this.storageKey);if(t)return JSON.parse(t);const e={};for(let r=1;r<=7;r++)e[r]={},["月","火","水","木","金","土"].forEach(s=>{e[r][s]={subject:"",memo:""}});return e}loadColors(){const t=localStorage.getItem(this.colorStorageKey);return t?JSON.parse(t):{}}saveData(){localStorage.setItem(this.storageKey,JSON.stringify(this.data))}saveColors(){localStorage.setItem(this.colorStorageKey,JSON.stringify(this.subjectColors))}getSubjectColor(t){if(!t)return"";if(this.subjectColors[t])return this.subjectColors[t];const e=Object.values(this.subjectColors),r=this.palette.find(s=>!e.includes(s))||this.palette[Object.keys(this.subjectColors).length%this.palette.length];return this.subjectColors[t]=r,this.saveColors(),r}setSubjectColor(t,e){this.subjectColors[t]=e,this.saveColors(),this.render()}toggleEdit(){this.isEditing=!this.isEditing,this.render()}updateCell(t,e,r,s){this.data[t]||(this.data[t]={}),this.data[t][e]||(this.data[t][e]={subject:"",memo:""}),this.data[t][e][r]=s,this.saveData()}getAllSubjects(){const t=new Set;return Object.values(this.data).forEach(e=>Object.values(e).forEach(r=>{r.subject&&t.add(r.subject)})),[...t]}renderCell(t,e,r){const s=t.subject?`background-color:${this.getSubjectColor(t.subject)};`:"";return this.isEditing?`
        <td class="border-b border-slate-200 p-0.5 text-center transition-colors" style="${s}">
          <div class="flex flex-col gap-0.5">
            <input type="text" class="w-full text-center border border-slate-300 rounded px-1 py-0.5 text-xs focus:border-primary-500 outline-none bg-white/80"
              value="${d(t.subject)}" placeholder="科目" data-p="${e}" data-d="${r}" data-f="subject">
            <input type="text" class="w-full text-center border border-slate-200 rounded px-1 text-[10px] text-slate-500 focus:border-primary-500 outline-none bg-white/60"
              value="${d(t.memo)}" placeholder="メモ" data-p="${e}" data-d="${r}" data-f="memo">
          </div>
        </td>`:`
      <td class="border-b border-slate-200 p-0.5 text-center transition-colors" style="${s}">
        <div class="min-h-[2rem] flex flex-col items-center justify-center px-0.5">
          <div class="font-semibold text-slate-800 text-[11px] leading-tight ${t.subject?"":"text-slate-300"}">${d(t.subject)||"　"}</div>
          ${t.memo?`<div class="text-[9px] text-slate-500 leading-tight">${d(t.memo)}</div>`:""}
        </div>
      </td>`}render(){if(!this.container)return;const{days:t,periods:e,periodTimes:r,showTimes:s}=this,a=`<tr>
      <th class="border-b border-r border-slate-200 p-1 text-center text-slate-400 font-medium bg-slate-50/50 w-10 text-[10px]">${s?"時限":""}</th>
      ${t.map(i=>`<th class="border-b border-slate-200 p-1 text-center text-slate-600 font-semibold bg-slate-50/50 text-xs">${i}</th>`).join("")}
    </tr>`,o=e.map(i=>{const l=r[i-1],p=t.map(g=>{const h=this.data[i]&&this.data[i][g]||{subject:"",memo:""},u={subject:h.subject||"",memo:h.memo??h.room??""};return this.renderCell(u,i,g)}).join("");return`<tr>
        <td class="border-b border-r border-slate-200 p-1 text-center bg-slate-50/50">
          <div class="font-bold text-slate-600 text-[11px]">${i}</div>
          ${s&&l?`<div class="text-[9px] text-slate-400 leading-tight">${l.start}<br>${l.end}</div>`:""}
        </td>${p}
      </tr>`}).join("");this.container.innerHTML=`<table class="w-full text-xs text-left border-collapse min-w-[280px]">
      <thead>${a}</thead><tbody>${o}</tbody></table>`,this.isEditing&&this.container.querySelectorAll("input").forEach(i=>{i.addEventListener("change",l=>{const{p,d:g,f:h}=l.target.dataset;this.updateCell(Number(p),g,h,l.target.value),h==="subject"&&(this.getSubjectColor(l.target.value),this.render())})})}}class k{constructor(t){this.container=document.getElementById(t),this.storageKey="class-portal-calendar-notes",this.currentDate=new Date,this.notes=this.loadNotes(),this.selectedDay=null,this.render()}loadNotes(){const t=localStorage.getItem(this.storageKey);return t?JSON.parse(t):{}}saveNotes(){localStorage.setItem(this.storageKey,JSON.stringify(this.notes))}noteKey(t,e,r){return`${t}-${String(e+1).padStart(2,"0")}-${String(r).padStart(2,"0")}`}getUpcomingNotes(t=3){const e=new Date;return e.setHours(0,0,0,0),Object.entries(this.notes).map(([r,s])=>({key:r,text:s,date:new Date(r+"T00:00:00")})).filter(r=>r.date>=e).sort((r,s)=>r.date-s.date).slice(0,t)}formatNoteDate(t){const e=["日","月","火","水","木","金","土"];return`${t.getMonth()+1}/${t.getDate()}（${e[t.getDay()]}）`}openNote(t){const e=this.currentDate.getFullYear(),r=this.currentDate.getMonth(),s=this.noteKey(e,r,t);this.selectedDay={year:e,month:r,day:t,key:s},this.renderNotePanel(s)}renderNotePanel(t){var a,o,i;const e=document.getElementById("calendar-note-panel");if(!e)return;const r=this.selectedDay,s=this.notes[t]||"";e.innerHTML=`
      <div class="mt-3 pt-3 border-t border-slate-100">
        <div class="flex items-center justify-between mb-2">
          <span class="text-sm font-semibold text-slate-700">
            ${r.year}/${r.month+1}/${r.day} のメモ
          </span>
          <button id="cal-note-close" class="text-slate-400 hover:text-slate-600 text-xs px-2 py-1 bg-slate-100 rounded">閉じる</button>
        </div>
        <textarea id="cal-note-input" class="w-full text-sm border border-slate-200 rounded-lg p-2 h-20 resize-none focus:border-primary-500 outline-none" placeholder="メモを入力...">${s}</textarea>
        <div class="flex gap-2 mt-2">
          <button id="cal-note-save" class="flex-1 bg-primary-600 text-white text-xs py-2 rounded-lg hover:bg-primary-700 transition-colors font-medium">保存</button>
          ${s?'<button id="cal-note-delete" class="px-3 bg-red-50 text-red-500 text-xs py-2 rounded-lg hover:bg-red-100 transition-colors">削除</button>':""}
        </div>
      </div>
    `,(a=e.querySelector("#cal-note-close"))==null||a.addEventListener("click",()=>{this.selectedDay=null,e.innerHTML="",this.renderUpcomingNotes()}),(o=e.querySelector("#cal-note-save"))==null||o.addEventListener("click",()=>{const l=e.querySelector("#cal-note-input").value.trim();l?this.notes[t]=l:delete this.notes[t],this.saveNotes(),this.selectedDay=null,e.innerHTML="",this.render()}),(i=e.querySelector("#cal-note-delete"))==null||i.addEventListener("click",()=>{delete this.notes[t],this.saveNotes(),this.selectedDay=null,e.innerHTML="",this.render()})}renderUpcomingNotes(){const t=document.getElementById("calendar-upcoming-notes");if(!t)return;const e=this.getUpcomingNotes(3);if(!e.length){t.innerHTML='<p class="text-xs text-slate-400 italic">直近のメモはありません</p>';return}t.innerHTML=e.map(r=>`
      <div class="flex gap-2 items-start text-xs py-1.5 border-b border-slate-100 last:border-0">
        <span class="font-semibold text-primary-600 shrink-0 w-20">${this.formatNoteDate(r.date)}</span>
        <span class="text-slate-600 line-clamp-2">${r.text}</span>
      </div>
    `).join("")}render(){if(!this.container)return;const t=this.currentDate.getFullYear(),e=this.currentDate.getMonth(),r=new Date,s=r.getFullYear(),a=r.getMonth(),o=r.getDate(),i=new Date(t,e+1,0).getDate(),p=(new Date(t,e,1).getDay()+6)%7,g=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],h=["月","火","水","木","金","土","日"];let u=`
      <div class="flex items-center justify-between mb-3">
        <button class="cal-prev p-1 hover:bg-slate-100 rounded-lg text-slate-500 transition-colors"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
        <div class="font-semibold text-slate-800">${t}年 ${g[e]}</div>
        <button class="cal-next p-1 hover:bg-slate-100 rounded-lg text-slate-500 transition-colors"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
      </div>
      <div class="grid grid-cols-7 gap-0.5 text-center text-[10px] mb-0.5">
    `;h.forEach((n,m)=>{u+=`<div class="font-medium ${m===5?"text-blue-500":m===6?"text-red-500":"text-slate-400"} pb-0.5">${n}</div>`}),u+='</div><div class="grid grid-cols-7 gap-0.5 text-xs">';for(let n=0;n<p;n++)u+="<div></div>";for(let n=1;n<=i;n++){const m=t===s&&e===a&&n===o,b=(p+n-1)%7,w=!!this.notes[this.noteKey(t,e,n)];let y="text-slate-700";b===5&&(y="text-blue-600"),b===6&&(y="text-red-600");let f="w-7 h-7 flex flex-col items-center justify-center cursor-pointer transition-colors rounded-md relative mx-auto";m?f+=" bg-primary-500 text-white font-bold shadow-sm":f+=` hover:bg-slate-100 ${y}`,u+=`
        <div class="${f}" data-day="${n}">
          <span>${n}</span>
          ${w?`<span class="absolute bottom-0.5 w-1 h-1 rounded-full ${m?"bg-white/70":"bg-primary-400"}"></span>`:""}
        </div>
      `}u+="</div>",u+='<p class="text-[10px] text-slate-400 mt-2 text-center">日付をクリックしてメモを追加</p>',u+='<div id="calendar-note-panel"></div>',this.container.innerHTML=u,window.lucide&&window.lucide.createIcons({root:this.container}),this.container.querySelector(".cal-prev").addEventListener("click",()=>this.changeMonth(-1)),this.container.querySelector(".cal-next").addEventListener("click",()=>this.changeMonth(1)),this.container.querySelectorAll("[data-day]").forEach(n=>{n.addEventListener("click",()=>this.openNote(parseInt(n.dataset.day)))}),this.renderUpcomingNotes()}changeMonth(t){this.currentDate.setMonth(this.currentDate.getMonth()+t),this.selectedDay=null,this.render()}}class S{constructor(t){this.container=document.getElementById(t),this.storageKey="class-portal-todo-v2",this.MAX_PRIORITY=5,this.tasks=this.loadData(),this.dragSrcId=null,this.render()}loadData(){const t=localStorage.getItem(this.storageKey);return t?JSON.parse(t):[]}saveData(){localStorage.setItem(this.storageKey,JSON.stringify(this.tasks))}addTask(t,e,r){if(t.trim()){if(r&&this.tasks.filter(s=>s.priority&&!s.done).length>=this.MAX_PRIORITY){alert(`重要タスクは最大${this.MAX_PRIORITY}件までです。`);return}this.tasks.push({id:Date.now().toString(),text:t.trim(),deadline:e||"",priority:r,done:!1,createdAt:new Date().toISOString()}),this.saveData(),this.render()}}toggleDone(t){const e=this.tasks.find(r=>r.id===t);e&&(e.done=!e.done,this.saveData(),this.render())}deleteTask(t){this.tasks=this.tasks.filter(e=>e.id!==t),this.saveData(),this.render()}moveTask(t,e){const r=this.tasks.find(s=>s.id===t);return r?e&&this.tasks.filter(s=>s.priority&&!s.done&&s.id!==t).length>=this.MAX_PRIORITY?(alert(`重要タスクは最大${this.MAX_PRIORITY}件までです。`),!1):(r.priority=e,this.saveData(),this.render(),!0):!1}formatDeadline(t){if(!t)return"";const e=new Date(t+"T00:00:00"),r=new Date;r.setHours(0,0,0,0);const s=Math.ceil((e-r)/864e5),a=`${e.getMonth()+1}/${e.getDate()}`;return s<0?`<span class="text-red-500 font-bold">${a} 期限切れ</span>`:s===0?`<span class="text-red-500 font-bold">${a} 今日</span>`:s<=3?`<span class="text-amber-500 font-semibold">${a} あと${s}日</span>`:`<span class="text-slate-400">${a} まで</span>`}buildTaskCard(t){const e=this.formatDeadline(t.deadline),r=t.done?"opacity-50 line-through":"",s=t.priority?"bg-red-50/70 border-red-100":"bg-slate-50/70 border-slate-100",a=t.done?"bg-primary-500 border-primary-500":t.priority?"border-red-300 hover:border-red-500":"border-slate-300 hover:border-primary-500";return`
      <div class="task-card group flex items-start gap-2 p-2.5 ${s} border rounded-xl transition-all cursor-grab active:cursor-grabbing hover:shadow-sm"
        draggable="true" data-id="${t.id}" data-priority="${t.priority?"1":"0"}">
        <button class="btn-toggle shrink-0 w-5 h-5 mt-0.5 rounded-full border-2 ${a} transition-colors flex items-center justify-center" data-id="${t.id}">
          ${t.done?'<i data-lucide="check" class="w-3 h-3 text-white"></i>':""}
        </button>
        <div class="flex-1 min-w-0">
          <p class="text-sm text-slate-800 break-words ${r}">${d(t.text)}</p>
          ${e?`<p class="text-[10px] mt-0.5">${e}</p>`:""}
        </div>
        <button class="btn-delete shrink-0 opacity-0 group-hover:opacity-100 text-slate-300 hover:text-red-500 transition-all" data-id="${t.id}">
          <i data-lucide="x" class="w-4 h-4"></i>
        </button>
      </div>`}buildColumn(t,e,r){const s=e?`<div class="flex items-center gap-1.5 mb-2"><i data-lucide="alert-circle" class="w-4 h-4 text-red-500"></i><span class="text-sm font-semibold text-slate-700">重要タスク</span><span class="text-[10px] px-1.5 py-0.5 bg-red-100 text-red-600 rounded-full ml-auto">最大${this.MAX_PRIORITY}件</span></div>`:'<div class="flex items-center gap-1.5 mb-2"><i data-lucide="list" class="w-4 h-4 text-slate-500"></i><span class="text-sm font-semibold text-slate-700">通常タスク</span></div>',a=t.length===0,o=a?e?"border-red-200 bg-red-50/30":"border-slate-200 bg-slate-50/30":"border-transparent",i=a?`<p class="text-xs ${e?"text-red-300":"text-slate-300"} text-center py-4">ここにドロップ</p>`:t.map(p=>this.buildTaskCard(p)).join("");return`<div>${s}<div id="${e?"todo-priority-list":"todo-normal-list"}" class="drop-zone min-h-[80px] space-y-2 p-2 rounded-xl border-2 border-dashed ${o}" data-target-priority="${e?"1":"0"}">${i}</div></div>`}render(){if(!this.container)return;const t=this.tasks.filter(e=>e.priority&&!e.done).length;this.container.innerHTML=`
      <div class="mb-4 p-3 bg-slate-50 rounded-xl border border-slate-100 space-y-2">
        <input type="text" id="todo-text" placeholder="タスクを入力..." class="w-full rounded-lg border border-slate-200 text-sm p-2 outline-none focus:border-primary-500">
        <div class="flex gap-2 items-center">
          <label class="text-xs text-slate-500 shrink-0 font-medium">締切日：</label>
          <input type="date" id="todo-deadline" class="flex-1 rounded-lg border border-slate-200 text-sm p-2 outline-none focus:border-primary-500 text-slate-600">
          <label class="flex items-center gap-1 text-xs text-slate-500 cursor-pointer shrink-0">
            <input type="checkbox" id="todo-no-deadline" class="accent-primary-500"> なし
          </label>
        </div>
        <div class="flex gap-2">
          <button id="btn-add-priority" class="flex-1 bg-red-500 hover:bg-red-600 text-white py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1">
            <i data-lucide="alert-circle" class="w-4 h-4"></i>重要に追加<span class="text-xs opacity-80">(${t}/${this.MAX_PRIORITY})</span>
          </button>
          <button id="btn-add-normal"   class="flex-1 bg-slate-700 hover:bg-slate-800 text-white py-2 rounded-lg text-sm font-medium transition-colors">通常に追加</button>
        </div>
      </div>
      <div class="grid grid-cols-2 gap-4">
        ${this.buildColumn(this.tasks.filter(e=>e.priority),!0,"ここにドロップ")}
        ${this.buildColumn(this.tasks.filter(e=>!e.priority),!1,"ここにドロップ")}
      </div>`,window.lucide&&lucide.createIcons({root:this.container}),this.attachEvents()}attachEvents(){const t=this.container,e=t.querySelector("#todo-no-deadline"),r=t.querySelector("#todo-deadline");e.addEventListener("change",()=>{r.disabled=e.checked,e.checked&&(r.value="")});const s=()=>({text:t.querySelector("#todo-text").value,dl:e.checked?"":r.value}),a=()=>{t.querySelector("#todo-text").value="",r.value="",e.checked=!1,r.disabled=!1};t.querySelector("#btn-add-normal").addEventListener("click",()=>{const o=s();this.addTask(o.text,o.dl,!1),a()}),t.querySelector("#btn-add-priority").addEventListener("click",()=>{const o=s();this.addTask(o.text,o.dl,!0),a()}),t.querySelector("#todo-text").addEventListener("keydown",o=>{if(o.key==="Enter"){const i=s();this.addTask(i.text,i.dl,!1),a()}}),t.querySelectorAll(".btn-toggle").forEach(o=>o.addEventListener("click",()=>this.toggleDone(o.dataset.id))),t.querySelectorAll(".btn-delete").forEach(o=>o.addEventListener("click",()=>this.deleteTask(o.dataset.id))),t.querySelectorAll(".task-card").forEach(o=>{o.addEventListener("dragstart",i=>{this.dragSrcId=o.dataset.id,o.classList.add("opacity-50"),i.dataTransfer.effectAllowed="move"}),o.addEventListener("dragend",()=>o.classList.remove("opacity-50"))}),t.querySelectorAll(".drop-zone").forEach(o=>{o.addEventListener("dragover",i=>{i.preventDefault(),o.classList.add("bg-primary-50","border-primary-300")}),o.addEventListener("dragleave",()=>o.classList.remove("bg-primary-50","border-primary-300")),o.addEventListener("drop",i=>{i.preventDefault(),o.classList.remove("bg-primary-50","border-primary-300"),this.dragSrcId&&(this.moveTask(this.dragSrcId,o.dataset.targetPriority==="1"),this.dragSrcId=null)})})}}class I{constructor(t){this.container=document.getElementById(t),this.storageKey="class-portal-links",this.defaultLinks=[{id:"1",title:"全商検定タイピング",url:"https://mkt918.github.io/typing03/",icon:"keyboard",color:"text-blue-500"},{id:"2",title:"情報処理用語クイズ",url:"https://mkt918.github.io/quizmillion/",icon:"help-circle",color:"text-amber-500"},{id:"3",title:"トランプでアルゴリズム",url:"https://mkt918.github.io/pro_01/",icon:"layers",color:"text-red-500"},{id:"4",title:"プログラミングでお絵描き",url:"https://mkt918.github.io/pro_02/",icon:"palette",color:"text-purple-500"},{id:"5",title:"愛知県ジグソーパズル",url:"https://mkt918.github.io/045_aichipazuru/",icon:"puzzle",color:"text-emerald-500"},{id:"6",title:"マス目プログラミング",url:"https://mkt918.github.io/pro_04/",icon:"grid",color:"text-indigo-500"},{id:"7",title:"株式投資ゲーム",url:"https://mkt918.github.io/stock_01/",icon:"trending-up",color:"text-green-600"},{id:"8",title:"情報処理計算問題",url:"https://mkt918.github.io/pro_05_keisan/index.html",icon:"calculator",color:"text-slate-700"}],this.links=this.loadData(),this.render()}loadData(){const t=localStorage.getItem(this.storageKey);if(!t)return[...this.defaultLinks];const e=JSON.parse(t),r=[...this.defaultLinks];return e.forEach(s=>{r.find(a=>a.id===s.id)||r.push(s)}),r}saveData(){const t=this.links.filter(e=>!this.defaultLinks.find(r=>r.id===e.id));localStorage.setItem(this.storageKey,JSON.stringify(t))}addLink(t,e){!t||!e||(this.links.push({id:Date.now().toString(),title:t,url:e,icon:"link-2",color:"text-primary-500",custom:!0}),this.saveData(),this.render())}deleteLink(t){this.links=this.links.filter(e=>e.id!==t),this.saveData(),this.render()}renderLink(t){return`
      <div class="relative group">
        <a href="${t.url}" target="_blank" class="flex items-center gap-3 p-3 bg-slate-50 hover:bg-primary-50 border border-slate-100 hover:border-primary-100 rounded-xl transition-all">
          <div class="w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center shrink-0 border border-slate-100">
            <i data-lucide="${t.icon}" class="w-4 h-4 ${t.color}"></i>
          </div>
          <span class="text-sm font-medium text-slate-700 truncate">${d(t.title)}</span>
        </a>
        ${t.custom?`
          <button class="absolute -top-2 -right-2 bg-white rounded-full p-1 border border-slate-200 text-slate-400 hover:text-red-500 opacity-0 group-hover:opacity-100 shadow-sm transition-all" data-delete-id="${t.id}">
            <i data-lucide="x" class="w-3 h-3"></i>
          </button>
        `:""}
      </div>
    `}render(){var t;this.container&&(this.container.innerHTML=`
      <div class="flex flex-col gap-2 mb-4">
        ${this.links.map(e=>this.renderLink(e)).join("")}
      </div>
      <div class="pt-4 border-t border-slate-100">
        <p class="text-xs text-slate-500 mb-2 font-medium">リンクを追加</p>
        <div class="flex flex-col gap-2">
          <input type="text" id="link-title" placeholder="サイト名" class="w-full rounded-lg border-slate-200 text-sm p-2 border outline-none focus:border-primary-500">
          <div class="flex gap-2">
            <input type="url" id="link-url" placeholder="URL (https://...)" class="flex-1 rounded-lg border-slate-200 text-sm p-2 border outline-none focus:border-primary-500">
            <button id="btn-add-link" class="bg-slate-800 hover:bg-slate-900 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors shrink-0">追加</button>
          </div>
        </div>
      </div>
    `,window.lucide&&window.lucide.createIcons({root:this.container}),(t=this.container.querySelector("#btn-add-link"))==null||t.addEventListener("click",()=>{this.addLink(this.container.querySelector("#link-title").value.trim(),this.container.querySelector("#link-url").value.trim())}),this.container.querySelectorAll("[data-delete-id]").forEach(e=>{e.addEventListener("click",()=>this.deleteLink(e.dataset.deleteId))}))}}class E{constructor(t,e){this.container=document.getElementById(t),this.dataSource="data/lessons.json",this.settings=e,this.lessons=[],this.activeFilter="all",this.loadData()}get limit(){var t,e;return((e=(t=this.settings)==null?void 0:t.settings)==null?void 0:e.lessonsLimit)||0}async loadData(){try{const t=await fetch(this.dataSource);if(!t.ok)throw new Error;this.lessons=await t.json(),this.render()}catch{this.container&&(this.container.innerHTML='<p class="text-slate-500 text-sm py-4">授業データが見つかりません。update-lessons.batを実行してください。</p>')}}getAllSubjects(){const t=new Set;return this.lessons.forEach(e=>(e.tags||[]).forEach(r=>t.add(r))),[...t]}getFiltered(){let t=this.activeFilter==="all"?this.lessons:this.lessons.filter(e=>(e.tags||[]).includes(this.activeFilter));return this.limit>0?t.slice(0,this.limit):t}renderFilterTabs(){const t=this.getAllSubjects();if(!t.length)return"";const e=(r,s)=>`<button class="lesson-filter-btn text-xs px-3 py-1 rounded-full font-medium transition-all ${this.activeFilter===r?"bg-primary-500 text-white":"bg-slate-100 text-slate-600 hover:bg-primary-50"}" data-filter="${d(r)}">${d(s)}</button>`;return`<div class="flex flex-wrap gap-2 mb-4">${e("all","すべて")}${t.map(r=>e(r,r)).join("")}</div>`}renderCard(t){const e=(t.tags||[]).map(r=>`<button class="lesson-tag-btn text-[10px] px-2 py-0.5 rounded-full font-medium transition-all ${this.activeFilter===r?"bg-primary-500 text-white":"bg-primary-50 text-primary-600 hover:bg-primary-100"}" data-filter="${d(r)}">${d(r)}</button>`).join("");return`
      <a href="${t.url}" class="lesson-card block p-4 bg-slate-50 hover:bg-primary-50 border border-slate-100 hover:border-primary-200 rounded-xl transition-all group flex flex-col h-full cursor-pointer shadow-sm hover:shadow-md">
        <div class="flex justify-between items-start mb-2">
          <div class="flex flex-wrap gap-1">${e}</div>
          <div class="text-[10px] text-slate-400 font-medium shrink-0 ml-2">${d(t.date)}</div>
        </div>
        <h3 class="text-sm font-bold text-slate-800 group-hover:text-primary-600 transition-colors mb-1 line-clamp-2">${d(t.title)}</h3>
        <p class="text-xs text-slate-500 line-clamp-2 mt-auto leading-relaxed">${d(t.summary||"")}</p>
      </a>
    `}render(){if(!this.container)return;if(!this.lessons.length){this.container.innerHTML='<p class="text-slate-500 text-sm py-4">授業データがありません。</p>';return}const t=this.getFiltered(),e=t.length?t.map(s=>this.renderCard(s)).join(""):'<p class="text-slate-400 text-sm py-6 text-center col-span-full">この科目の授業がありません。</p>',r=`<p class="text-xs text-slate-400 text-center mt-3">全${this.lessons.length}件中 ${t.length}件表示</p>`;this.container.innerHTML=`
      ${this.renderFilterTabs()}
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">${e}</div>
      ${r}
    `,this.container.querySelectorAll(".lesson-filter-btn, .lesson-tag-btn").forEach(s=>{s.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),this.activeFilter=s.dataset.filter,this.render()})})}}class L{constructor(){this.storageKey="class-portal-settings",this.defaultSettings={themeColor:"#0ea5e9",wallpaperMode:"pattern",wallpaperImage:"",wallpaperColor:"#f8fafc",portalTitle:"学習ポータル",cardOpacity:90,fontSize:"md",timetableDays:5,timetablePeriods:6,showPeriodTimes:!1,periodTimes:[{start:"08:50",end:"09:40"},{start:"09:50",end:"10:40"},{start:"10:50",end:"11:40"},{start:"13:00",end:"13:50"},{start:"14:00",end:"14:50"},{start:"15:00",end:"15:50"},{start:"16:00",end:"16:50"}],lessonsLimit:0,headerStyle:"glass",headerBgColor:"",widgetVisibility:{timetable:!0,lessons:!0,calendar:!0,todo:!0,links:!0}},this.settings=this.loadData(),this.applySettings()}loadData(){const t=localStorage.getItem(this.storageKey),e={...this.defaultSettings};if(!t)return e;const r=JSON.parse(t);return{...e,...r,periodTimes:r.periodTimes||e.periodTimes,widgetVisibility:{...e.widgetVisibility,...r.widgetVisibility||{}}}}saveData(){localStorage.setItem(this.storageKey,JSON.stringify(this.settings)),this.applySettings()}updateSetting(t,e){this.settings[t]=e,this.saveData()}applySettings(){const t=this.settings;this._applyTheme(t),this._applyWallpaper(t),this._applyHeader(t),this._applyWidgets(t),this._applyTitle(t)}_applyTheme(t){const e=this._hexToRgb(t.themeColor)||{r:14,g:165,b:233},r=(t.cardOpacity/100).toFixed(2);let s=document.getElementById("dynamic-theme-styles");s||(s=document.createElement("style"),s.id="dynamic-theme-styles",document.head.appendChild(s)),s.textContent=`
      :root {
        --tw-color-primary-50:  rgba(${e.r},${e.g},${e.b},0.05);
        --tw-color-primary-100: rgba(${e.r},${e.g},${e.b},0.15);
        --tw-color-primary-500: rgb(${e.r},${e.g},${e.b});
        --tw-color-primary-600: rgb(${Math.max(0,e.r-20)},${Math.max(0,e.g-20)},${Math.max(0,e.b-20)});
      }
      .bg-primary-50  { background-color: var(--tw-color-primary-50)  !important; }
      .bg-primary-100 { background-color: var(--tw-color-primary-100) !important; }
      .bg-primary-500 { background-color: var(--tw-color-primary-500) !important; }
      .bg-primary-600 { background-color: var(--tw-color-primary-600) !important; }
      .bg-primary-700 { background-color: rgb(${Math.max(0,e.r-40)},${Math.max(0,e.g-40)},${Math.max(0,e.b-40)}) !important; }
      .text-primary-500 { color: var(--tw-color-primary-500) !important; }
      .text-primary-600 { color: var(--tw-color-primary-600) !important; }
      .from-primary-600 { --tw-gradient-from: var(--tw-color-primary-600) !important; }
      .hover\\:bg-primary-50:hover  { background-color: var(--tw-color-primary-50)  !important; }
      .hover\\:bg-primary-100:hover { background-color: var(--tw-color-primary-100) !important; }
      .hover\\:bg-primary-700:hover { background-color: rgb(${Math.max(0,e.r-40)},${Math.max(0,e.g-40)},${Math.max(0,e.b-40)}) !important; }
      .hover\\:border-primary-100:hover { border-color: var(--tw-color-primary-100) !important; }
      .hover\\:border-primary-200:hover { border-color: rgba(${e.r},${e.g},${e.b},0.3) !important; }
      .hover\\:text-primary-600:hover { color: var(--tw-color-primary-600) !important; }
      .accent-primary-500 { accent-color: var(--tw-color-primary-500); }
      .border-primary-500 { border-color: var(--tw-color-primary-500) !important; }
      .border-primary-100 { border-color: var(--tw-color-primary-100) !important; }
      .focus\\:border-primary-500:focus { border-color: var(--tw-color-primary-500) !important; }
      section { background-color: rgba(255,255,255,${r}) !important; backdrop-filter: blur(8px); }
      #main-header { background-color: rgba(255,255,255,${Math.min(1,parseFloat(r)+.1).toFixed(2)}) !important; }
      ${t.fontSize==="sm"?"html { font-size: 14px; }":""}
      ${t.fontSize==="md"?"html { font-size: 16px; }":""}
      ${t.fontSize==="lg"?"html { font-size: 18px; }":""}
    `}_applyWallpaper(t){const e=document.body,r="var(--tw-color-primary-100)",s="#f8fafc";e.style.backgroundAttachment="fixed";const a={image:()=>{if(!t.wallpaperImage){a.pattern();return}e.style.backgroundImage=`url(${t.wallpaperImage})`,e.style.backgroundSize="cover",e.style.backgroundPosition="center",e.style.backgroundColor=""},color:()=>{e.style.backgroundImage="none",e.style.backgroundSize="",e.style.backgroundColor=t.wallpaperColor||s},pattern:()=>{e.style.backgroundImage=`radial-gradient(${r} 1px, transparent 1px)`,e.style.backgroundSize="20px 20px",e.style.backgroundColor=s},"dots-lg":()=>{e.style.backgroundImage=`radial-gradient(${r} 2px, transparent 2px)`,e.style.backgroundSize="40px 40px",e.style.backgroundColor=s},grid:()=>{e.style.backgroundImage=`linear-gradient(${r} 1px,transparent 1px),linear-gradient(90deg,${r} 1px,transparent 1px)`,e.style.backgroundSize="30px 30px",e.style.backgroundColor=s},diagonal:()=>{e.style.backgroundImage=`repeating-linear-gradient(45deg,${r} 0,${r} 1px,transparent 0,transparent 50%)`,e.style.backgroundSize="16px 16px",e.style.backgroundColor=s},cross:()=>{e.style.backgroundImage=`repeating-linear-gradient(45deg,${r} 0,${r} 1px,transparent 0,transparent 50%),repeating-linear-gradient(-45deg,${r} 0,${r} 1px,transparent 0,transparent 50%)`,e.style.backgroundSize="14px 14px",e.style.backgroundColor=s},wave:()=>{e.style.backgroundImage=`repeating-linear-gradient(0deg,${r},${r} 1px,transparent 1px,transparent 20px),repeating-linear-gradient(90deg,${r},${r} 1px,transparent 1px,transparent 20px)`,e.style.backgroundSize="20px 40px",e.style.backgroundColor=s},triangle:()=>{e.style.backgroundImage=`linear-gradient(135deg,${r} 25%,transparent 25%) -10px 0,linear-gradient(225deg,${r} 25%,transparent 25%) -10px 0,linear-gradient(315deg,${r} 25%,transparent 25%),linear-gradient(45deg,${r} 25%,transparent 25%)`,e.style.backgroundSize="20px 20px",e.style.backgroundColor=s},checker:()=>{e.style.backgroundImage=`repeating-conic-gradient(${r} 0% 25%,transparent 0% 50%)`,e.style.backgroundSize="24px 24px",e.style.backgroundColor=s},"gradient-v":()=>{e.style.backgroundImage=`linear-gradient(180deg,${r} 0%,transparent 50%)`,e.style.backgroundSize="",e.style.backgroundColor=s}};(a[t.wallpaperMode]||a.pattern)()}_applyHeader(t){const e=document.getElementById("main-header");if(!e)return;e.removeAttribute("class");const r="sticky top-0 z-50 transition-all duration-300",s=t.headerStyle||"glass",a=t.headerBgColor&&t.headerBgColor!==""?t.headerBgColor:t.themeColor;s==="glass"?(e.className=`${r} bg-white/80 backdrop-blur-md shadow-sm`,e.style.cssText=""):s==="solid"?(e.className=`${r} bg-white shadow-md border-b border-slate-200`,e.style.cssText=""):s==="colored"?(e.className=`${r} shadow-lg`,e.style.backgroundColor=a,e.style.backgroundImage=""):s==="gradient"&&(e.className=`${r} shadow-md`,e.style.backgroundColor="",e.style.backgroundImage=`linear-gradient(135deg, ${a}, ${this._adjustColor(a,-40)})`);const o=e.querySelector("h1");o&&(s==="colored"||s==="gradient"?(o.style.webkitTextFillColor="white",o.classList.remove("bg-clip-text","text-transparent","bg-gradient-to-r")):o.style.webkitTextFillColor="")}_applyWidgets(t){const e=t.widgetVisibility||{},r={timetable:"#card-timetable",lessons:"#section-lessons",calendar:"#section-calendar",todo:"#section-todo",links:"#section-links"};for(const[s,a]of Object.entries(r)){const o=document.querySelector(a);o&&(o.style.display=e[s]!==!1?"":"none")}}_applyTitle(t){const e=document.querySelector("#main-header h1");e&&(e.textContent=t.portalTitle||"学習ポータル"),document.title=(t.portalTitle||"学習ポータル")+" - Dashboard"}_hexToRgb(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}_adjustColor(t,e){return"#"+t.replace(/^#/,"").replace(/../g,r=>("0"+Math.min(255,Math.max(0,parseInt(r,16)+e)).toString(16)).slice(-2))}}class C{constructor({settings:t,timetable:e,calendar:r,links:s,todo:a,lessons:o}){this.settings=t,this.timetable=e,this.calendar=r,this.links=s,this.todo=a,this.lessons=o,this.modal=document.getElementById("settings-modal"),this._init()}_init(){var t,e;document.querySelectorAll(".settings-tab").forEach(r=>{r.addEventListener("click",()=>{const s=r.dataset.tab;document.querySelectorAll(".settings-tab").forEach(a=>{const o=a.dataset.tab===s;a.classList.toggle("bg-white",o),a.classList.toggle("shadow-sm",o),a.classList.toggle("text-primary-600",o),a.classList.toggle("text-slate-500",!o)}),document.querySelectorAll(".settings-panel").forEach(a=>a.classList.toggle("hidden",a.id!==`tab-${s}`)),s==="colors"&&this._renderSubjectColorList()})}),document.querySelectorAll(".color-preset").forEach(r=>{r.addEventListener("click",()=>{document.getElementById("s-color").value=r.dataset.color})}),document.querySelectorAll(".header-color-preset").forEach(r=>{r.addEventListener("click",()=>{document.getElementById("s-header-bg-color").value=r.dataset.color,this._updateHeaderPreviews(r.dataset.color)})}),(t=document.getElementById("btn-reset-header-color"))==null||t.addEventListener("click",()=>{document.getElementById("s-header-bg-color").value="",this._updateHeaderPreviews(this.settings.settings.themeColor)}),(e=document.getElementById("s-header-bg-color"))==null||e.addEventListener("input",r=>{this._updateHeaderPreviews(r.target.value)}),document.getElementById("s-bg-mode").addEventListener("change",r=>{document.getElementById("s-bg-color-row").classList.toggle("hidden",r.target.value!=="color"),document.getElementById("s-bg-image-row").classList.toggle("hidden",r.target.value!=="image")}),document.getElementById("s-opacity").addEventListener("input",r=>{document.getElementById("s-opacity-val").textContent=r.target.value}),document.addEventListener("change",r=>{r.target.id==="s-tt-periods"&&this._buildPeriodTimeInputs(this.settings.settings.periodTimes)}),document.getElementById("s-bg-file").addEventListener("change",r=>{const s=r.target.files[0];if(s){const a=new FileReader;a.onload=o=>{document.getElementById("s-bg-url").value=o.target.result},a.readAsDataURL(s)}}),document.getElementById("btn-settings").addEventListener("click",()=>this.open()),document.getElementById("btn-close-settings").addEventListener("click",()=>this.close()),this.modal.addEventListener("click",r=>{r.target===this.modal&&this.close()}),document.getElementById("btn-save-settings").addEventListener("click",()=>this._save()),document.getElementById("btn-reset-settings").addEventListener("click",()=>{Object.assign(this.settings.settings,this.settings.defaultSettings),this.settings.saveData(),this.timetable.render(),this.calendar.render(),this.close()})}open(){var i;const t=this.settings.settings,e=l=>document.getElementById(l);e("s-portal-title").value=t.portalTitle||"",e("s-color").value=t.themeColor,e("s-bg-mode").value=t.wallpaperMode,e("s-bg-color").value=t.wallpaperColor||"#f8fafc",e("s-bg-color-row").classList.toggle("hidden",t.wallpaperMode!=="color"),e("s-bg-image-row").classList.toggle("hidden",t.wallpaperMode!=="image"),e("s-bg-url").value=(i=t.wallpaperImage)!=null&&i.startsWith("http")?t.wallpaperImage:"",e("s-opacity").value=t.cardOpacity,e("s-opacity-val").textContent=t.cardOpacity,e("s-tt-days").value=t.timetableDays,e("s-tt-periods").value=t.timetablePeriods,e("s-tt-showtimes").checked=t.showPeriodTimes,e("s-lessons-limit").value=t.lessonsLimit,document.querySelector(`input[name="s-fontsize"][value="${t.fontSize}"]`).checked=!0;const r=t.widgetVisibility||{};e("w-timetable").checked=r.timetable!==!1,e("w-lessons").checked=r.lessons!==!1,e("w-calendar").checked=r.calendar!==!1,e("w-todo").checked=r.todo!==!1,e("w-links").checked=r.links!==!1;const s=document.querySelector(`input[name="s-header-style"][value="${t.headerStyle||"glass"}"]`);s&&(s.checked=!0);const a=document.getElementById("s-header-bg-color");a&&(a.value=t.headerBgColor||"#0ea5e9");const o=t.headerBgColor&&t.headerBgColor!==""?t.headerBgColor:t.themeColor;this._updateHeaderPreviews(o),this._buildPeriodTimeInputs(t.periodTimes),this.modal.classList.remove("hidden"),window.lucide&&lucide.createIcons({root:this.modal})}close(){this.modal.classList.add("hidden")}_save(){var r,s;const t=a=>document.getElementById(a),e=[...this.settings.settings.periodTimes];document.querySelectorAll(".period-time-start").forEach(a=>{const o=parseInt(a.dataset.idx);e[o]||(e[o]={start:"",end:""}),e[o].start=a.value}),document.querySelectorAll(".period-time-end").forEach(a=>{const o=parseInt(a.dataset.idx);e[o]||(e[o]={start:"",end:""}),e[o].end=a.value}),Object.assign(this.settings.settings,{portalTitle:t("s-portal-title").value||"学習ポータル",themeColor:t("s-color").value,wallpaperMode:t("s-bg-mode").value,wallpaperColor:t("s-bg-color").value,wallpaperImage:t("s-bg-url").value,cardOpacity:parseInt(t("s-opacity").value),timetableDays:parseInt(t("s-tt-days").value),timetablePeriods:parseInt(t("s-tt-periods").value),showPeriodTimes:t("s-tt-showtimes").checked,periodTimes:e,fontSize:document.querySelector('input[name="s-fontsize"]:checked').value,lessonsLimit:parseInt(t("s-lessons-limit").value),headerStyle:((r=document.querySelector('input[name="s-header-style"]:checked'))==null?void 0:r.value)||"glass",headerBgColor:((s=document.getElementById("s-header-bg-color"))==null?void 0:s.value)||"",widgetVisibility:{timetable:t("w-timetable").checked,lessons:t("w-lessons").checked,calendar:t("w-calendar").checked,todo:t("w-todo").checked,links:t("w-links").checked}}),this.settings.saveData(),this.timetable.render(),this.calendar.render(),this.links.render(),this.todo.render(),this.lessons.render(),this.close()}_buildPeriodTimeInputs(t){var s;const e=document.getElementById("s-period-times-list"),r=parseInt(((s=document.getElementById("s-tt-periods"))==null?void 0:s.value)||6);e.innerHTML=Array.from({length:r},(a,o)=>{const i=t[o]||{start:"",end:""};return`<div class="flex items-center gap-2 text-sm">
        <span class="text-slate-500 w-8 text-right shrink-0">${o+1}限</span>
        <input type="time" class="period-time-start flex-1 border border-slate-200 rounded-lg px-2 py-1 text-sm outline-none focus:border-primary-500" value="${i.start}" data-idx="${o}">
        <span class="text-slate-400">〜</span>
        <input type="time" class="period-time-end flex-1 border border-slate-200 rounded-lg px-2 py-1 text-sm outline-none focus:border-primary-500" value="${i.end}" data-idx="${o}">
      </div>`}).join("")}_renderSubjectColorList(){const t=document.getElementById("subject-colors-list"),e=this.timetable.getAllSubjects();if(!e.length){t.innerHTML='<p class="text-sm text-slate-400 text-center py-4">時間割に科目を登録すると、ここに表示されます。</p>';return}t.innerHTML=e.map(r=>{const s=this.timetable.getSubjectColor(r);return`<div class="flex items-center gap-3 py-2 border-b border-slate-100">
        <div class="w-5 h-5 rounded-md border border-slate-200 shrink-0" style="background-color:${s}"></div>
        <span class="flex-1 text-sm font-medium text-slate-700">${r}</span>
        <input type="color" class="subject-color-input h-8 w-16 rounded border border-slate-200 cursor-pointer" value="${s}" data-subject="${r}">
      </div>`}).join(""),t.querySelectorAll(".subject-color-input").forEach(r=>{r.addEventListener("change",s=>this.timetable.setSubjectColor(s.target.dataset.subject,s.target.value))})}_updateHeaderPreviews(t){const e=document.getElementById("header-preview-colored"),r=document.getElementById("header-preview-gradient");e&&(e.style.backgroundColor=t),r&&(r.style.background=`linear-gradient(135deg, ${t}, ${t}aa)`)}}const v=new L,x=new $("timetable-container",v),T=new k("calendar-container"),D=new S("todo-container"),j=new I("links-container"),M=new E("lessons-container",v);new C({settings:v,timetable:x,calendar:T,links:j,todo:D,lessons:M});document.getElementById("btn-edit-timetable").addEventListener("click",c=>{x.toggleEdit(),c.target.textContent=x.isEditing?"完了":"編集"});lucide.createIcons();
