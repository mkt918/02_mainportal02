(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function e(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=e(o);fetch(o.href,a)}})();class k{constructor(t,e){this.container=document.getElementById(t),this.storageKey="class-portal-timetable",this.colorStorageKey="class-portal-subject-colors",this.settings=e,this.isEditing=!1,this.data=this.loadData(),this.subjectColors=this.loadColors(),this.palette=["#bfdbfe","#bbf7d0","#fef08a","#fecaca","#ddd6fe","#fed7aa","#cffafe","#fbcfe8","#e5e7eb","#d1fae5"],this.render()}get days(){var e,s;const t=((s=(e=this.settings)==null?void 0:e.settings)==null?void 0:s.timetableDays)||5;return["月","火","水","木","金","土"].slice(0,t)}get periods(){var e,s;const t=((s=(e=this.settings)==null?void 0:e.settings)==null?void 0:s.timetablePeriods)||6;return Array.from({length:t},(o,a)=>a+1)}get periodTimes(){var t,e;return((e=(t=this.settings)==null?void 0:t.settings)==null?void 0:e.periodTimes)||[]}get showTimes(){var t,e;return((e=(t=this.settings)==null?void 0:t.settings)==null?void 0:e.showPeriodTimes)||!1}loadData(){const t=localStorage.getItem(this.storageKey);if(t)return JSON.parse(t);const e={};for(let s=1;s<=7;s++){e[s]={};for(const o of["月","火","水","木","金","土"])e[s][o]={subject:"",room:""}}return e}loadColors(){const t=localStorage.getItem(this.colorStorageKey);return t?JSON.parse(t):{}}saveData(){localStorage.setItem(this.storageKey,JSON.stringify(this.data))}saveColors(){localStorage.setItem(this.colorStorageKey,JSON.stringify(this.subjectColors))}getSubjectColor(t){if(!t)return"";if(this.subjectColors[t])return this.subjectColors[t];const e=Object.values(this.subjectColors),o=this.palette.filter(a=>!e.includes(a))[0]||this.palette[Object.keys(this.subjectColors).length%this.palette.length];return this.subjectColors[t]=o,this.saveColors(),o}setSubjectColor(t,e){this.subjectColors[t]=e,this.saveColors(),this.render()}toggleEdit(){this.isEditing=!this.isEditing,this.render()}updateCell(t,e,s,o){this.data[t]||(this.data[t]={}),this.data[t][e]||(this.data[t][e]={subject:"",room:""}),this.data[t][e][s]=o,this.saveData()}getAllSubjects(){const t=new Set;for(const e of Object.values(this.data))for(const s of Object.values(e))s.subject&&t.add(s.subject);return[...t]}render(){if(!this.container)return;const t=this.days,e=this.periods,s=this.periodTimes,o=this.showTimes;let a=`
      <table class="w-full text-sm text-left border-collapse min-w-[500px]">
        <thead>
          <tr>
            <th class="border-b border-r border-slate-200 p-2 text-center text-slate-400 font-medium bg-slate-50/50 w-20 text-xs">
              ${o?"時限/時間":""}
            </th>
            ${t.map(i=>`<th class="border-b border-slate-200 p-2 text-center text-slate-600 font-semibold bg-slate-50/50">${i}</th>`).join("")}
          </tr>
        </thead>
        <tbody>
    `;for(const i of e){const d=s[i-1];a+=`<tr>
        <td class="border-b border-r border-slate-200 p-2 text-center bg-slate-50/50">
          <div class="font-bold text-slate-600 text-sm">${i}限</div>
          ${o&&d?`<div class="text-[10px] text-slate-400 mt-0.5 leading-tight">${d.start}<br>${d.end}</div>`:""}
        </td>`;for(const c of t){const l=this.data[i]&&this.data[i][c]?this.data[i][c]:{subject:"",room:""},u=l.subject?this.getSubjectColor(l.subject):"",y=u?`background-color: ${u};`:"";a+=`<td class="border-b border-slate-200 p-1 text-center transition-colors" style="${y}">`,this.isEditing?a+=`
            <div class="flex flex-col gap-1">
              <input type="text" class="w-full text-center border border-slate-300 rounded px-1 py-0.5 text-slate-800 text-sm focus:border-primary-500 outline-none bg-white/80" 
                value="${l.subject}" placeholder="科目" data-p="${i}" data-d="${c}" data-f="subject">
              <input type="text" class="w-full text-center border border-slate-200 rounded px-1 text-xs text-slate-500 focus:border-primary-500 outline-none bg-white/60" 
                value="${l.room}" placeholder="教室" data-p="${i}" data-d="${c}" data-f="room">
            </div>
          `:a+=`
            <div class="min-h-[3rem] flex flex-col items-center justify-center px-1">
              <div class="font-semibold text-slate-800 text-sm ${l.subject?"":"text-slate-300"}">${l.subject||"　"}</div>
              ${l.room?`<div class="text-[10px] text-slate-500 mt-0.5">${l.room}</div>`:""}
            </div>
          `,a+="</td>"}a+="</tr>"}a+="</tbody></table>",this.container.innerHTML=a,this.isEditing&&this.container.querySelectorAll("input").forEach(i=>{i.addEventListener("change",d=>{const{p:c,d:l,f:u}=d.target.dataset;this.updateCell(Number(c),l,u,d.target.value),u==="subject"&&(this.getSubjectColor(d.target.value),this.render())})})}}class S{constructor(t){this.container=document.getElementById(t),this.storageKey="class-portal-calendar-notes",this.currentDate=new Date,this.notes=this.loadNotes(),this.selectedDay=null,this.render()}loadNotes(){const t=localStorage.getItem(this.storageKey);return t?JSON.parse(t):{}}saveNotes(){localStorage.setItem(this.storageKey,JSON.stringify(this.notes))}noteKey(t,e,s){return`${t}-${String(e+1).padStart(2,"0")}-${String(s).padStart(2,"0")}`}changeMonth(t){this.currentDate.setMonth(this.currentDate.getMonth()+t),this.selectedDay=null,this.render()}openNote(t){const e=this.currentDate.getFullYear(),s=this.currentDate.getMonth(),o=this.noteKey(e,s,t);this.selectedDay={year:e,month:s,day:t,key:o},this.renderNotePanel(o)}renderNotePanel(t){var a,i,d;const e=document.getElementById("calendar-note-panel");if(!e)return;const s=this.selectedDay,o=this.notes[t]||"";e.innerHTML=`
      <div class="mt-4 pt-4 border-t border-slate-100">
        <div class="flex items-center justify-between mb-2">
          <span class="text-sm font-semibold text-slate-700">
            ${s.year}/${s.month+1}/${s.day} のメモ
          </span>
          <button id="cal-note-close" class="text-slate-400 hover:text-slate-600 text-xs px-2 py-1 bg-slate-100 rounded">閉じる</button>
        </div>
        <textarea id="cal-note-input" class="w-full text-sm border border-slate-200 rounded-lg p-2 h-24 resize-none focus:border-primary-500 outline-none" placeholder="メモを入力...">${o}</textarea>
        <div class="flex gap-2 mt-2">
          <button id="cal-note-save" class="flex-1 bg-primary-600 text-white text-xs py-2 rounded-lg hover:bg-primary-700 transition-colors font-medium">保存</button>
          ${o?'<button id="cal-note-delete" class="px-3 bg-red-50 text-red-500 text-xs py-2 rounded-lg hover:bg-red-100 transition-colors">削除</button>':""}
        </div>
      </div>
    `,(a=e.querySelector("#cal-note-close"))==null||a.addEventListener("click",()=>{this.selectedDay=null,e.innerHTML=""}),(i=e.querySelector("#cal-note-save"))==null||i.addEventListener("click",()=>{const c=e.querySelector("#cal-note-input").value.trim();c?this.notes[t]=c:delete this.notes[t],this.saveNotes(),this.selectedDay=null,e.innerHTML="",this.render()}),(d=e.querySelector("#cal-note-delete"))==null||d.addEventListener("click",()=>{delete this.notes[t],this.saveNotes(),this.selectedDay=null,e.innerHTML="",this.render()})}render(){if(!this.container)return;const t=this.currentDate.getFullYear(),e=this.currentDate.getMonth(),s=new Date,o=s.getFullYear(),a=s.getMonth(),i=s.getDate(),d=new Date(t,e+1,0).getDate(),l=(new Date(t,e,1).getDay()+6)%7,u=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],y=["月","火","水","木","金","土","日"];let h=`
      <div class="flex items-center justify-between mb-3">
        <button class="cal-prev p-1 hover:bg-slate-100 rounded-lg text-slate-500 transition-colors"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
        <div class="font-semibold text-slate-800">${t}年 ${u[e]}</div>
        <button class="cal-next p-1 hover:bg-slate-100 rounded-lg text-slate-500 transition-colors"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
      </div>
      <div class="grid grid-cols-7 gap-1 text-center text-xs mb-1">
    `;y.forEach((n,b)=>{h+=`<div class="font-medium ${b===5?"text-blue-500":b===6?"text-red-500":"text-slate-500"} pb-1">${n}</div>`}),h+='</div><div class="grid grid-cols-7 gap-1 text-sm">';for(let n=0;n<l;n++)h+="<div></div>";for(let n=1;n<=d;n++){const b=t===o&&e===a&&n===i,f=(l+n-1)%7,I=!!this.notes[this.noteKey(t,e,n)];let v="text-slate-700";f===5&&(v="text-blue-600"),f===6&&(v="text-red-600");let x="aspect-square flex flex-col items-center justify-center cursor-pointer transition-colors rounded-lg relative";b?x+=" bg-primary-500 text-white font-bold shadow-sm":x+=` hover:bg-slate-100 ${v}`,h+=`
        <div class="${x}" data-day="${n}">
          <span>${n}</span>
          ${I?`<span class="absolute bottom-0.5 w-1 h-1 rounded-full ${b?"bg-white/70":"bg-primary-400"}"></span>`:""}
        </div>
      `}h+="</div>",h+='<div id="calendar-note-panel"></div>',h+='<p class="text-xs text-slate-400 mt-3 text-center">日付をクリックしてメモを追加</p>',this.container.innerHTML=h,window.lucide&&window.lucide.createIcons({root:this.container}),this.container.querySelector(".cal-prev").addEventListener("click",()=>this.changeMonth(-1)),this.container.querySelector(".cal-next").addEventListener("click",()=>this.changeMonth(1)),this.container.querySelectorAll("[data-day]").forEach(n=>{n.addEventListener("click",()=>this.openNote(parseInt(n.dataset.day)))})}}class L{constructor(t,e,s){this.list=document.getElementById(t),this.input=document.getElementById(e),this.btnAdd=document.getElementById(s),this.storageKey="class-portal-todo",this.todos=this.loadData(),this.btnAdd&&this.input&&(this.btnAdd.addEventListener("click",()=>this.addTodo()),this.input.addEventListener("keypress",o=>{o.key==="Enter"&&this.addTodo()})),this.render()}loadData(){const t=localStorage.getItem(this.storageKey);return t?JSON.parse(t):[]}saveData(){localStorage.setItem(this.storageKey,JSON.stringify(this.todos))}addTodo(){const t=this.input.value.trim();t&&(this.todos.push({id:Date.now().toString(),text:t,completed:!1}),this.input.value="",this.saveData(),this.render())}toggleTodo(t){const e=this.todos.find(s=>s.id===t);e&&(e.completed=!e.completed,this.saveData(),this.render())}deleteTodo(t){this.todos=this.todos.filter(e=>e.id!==t),this.saveData(),this.render()}render(){if(!this.list)return;if(this.todos.length===0){this.list.innerHTML='<li class="text-sm text-slate-400 text-center py-4">タスクはありません</li>';return}let t="";this.todos.forEach(e=>{t+=`
        <li class="flex items-center gap-3 p-2 hover:bg-slate-50 rounded-lg group transition-colors border border-transparent hover:border-slate-100">
          <button class="todo-toggle text-slate-400 hover:text-primary-500 transition-colors" data-id="${e.id}">
            <i data-lucide="${e.completed?"check-circle-2":"circle"}" class="w-5 h-5 ${e.completed?"text-primary-500":""}"></i>
          </button>
          <span class="flex-1 text-sm ${e.completed?"text-slate-400 line-through":"text-slate-700"}">${this.escapeHTML(e.text)}</span>
          <button class="todo-delete opacity-0 group-hover:opacity-100 text-slate-400 hover:text-red-500 transition-all p-1 rounded hover:bg-red-50" data-id="${e.id}">
            <i data-lucide="trash-2" class="w-4 h-4"></i>
          </button>
        </li>
      `}),this.list.innerHTML=t,window.lucide&&window.lucide.createIcons({root:this.list}),this.list.querySelectorAll(".todo-toggle").forEach(e=>{e.addEventListener("click",s=>{this.toggleTodo(s.currentTarget.dataset.id)})}),this.list.querySelectorAll(".todo-delete").forEach(e=>{e.addEventListener("click",s=>{this.deleteTodo(s.currentTarget.dataset.id)})})}escapeHTML(t){return t.replace(/[&<>'"]/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[e]||e)}}class ${constructor(t){this.container=document.getElementById(t),this.storageKey="class-portal-links",this.defaultLinks=[{id:"1",title:"全商検定タイピング",url:"https://mkt918.github.io/typing03/",icon:"keyboard",color:"text-blue-500"},{id:"2",title:"情報処理用語クイズ",url:"https://mkt918.github.io/quizmillion/",icon:"help-circle",color:"text-amber-500"},{id:"3",title:"トランプでアルゴリズム",url:"https://mkt918.github.io/pro_01/",icon:"layers",color:"text-red-500"},{id:"4",title:"プログラミングでお絵描き",url:"https://mkt918.github.io/pro_02/",icon:"palette",color:"text-purple-500"},{id:"5",title:"愛知県ジグソーパズル",url:"https://mkt918.github.io/045_aichipazuru/",icon:"puzzle",color:"text-emerald-500"},{id:"6",title:"マス目プログラミング",url:"https://mkt918.github.io/pro_04/",icon:"grid",color:"text-indigo-500"},{id:"7",title:"株式投資ゲーム",url:"https://mkt918.github.io/stock_01/",icon:"trending-up",color:"text-green-600"},{id:"8",title:"情報処理計算問題",url:"https://mkt918.github.io/pro_05_keisan/index.html",icon:"calculator",color:"text-slate-700"}],this.links=this.loadData(),this.render()}loadData(){const t=localStorage.getItem(this.storageKey);if(!t)return[...this.defaultLinks];const e=JSON.parse(t),s=[...this.defaultLinks];return e.forEach(o=>{s.find(a=>a.id===o.id)||s.push(o)}),s}saveData(){const t=this.links.filter(e=>!this.defaultLinks.find(s=>s.id===e.id));localStorage.setItem(this.storageKey,JSON.stringify(t))}addLink(t,e){!t||!e||(this.links.push({id:Date.now().toString(),title:t,url:e,icon:"link-2",color:"text-primary-500",custom:!0}),this.saveData(),this.render())}deleteLink(t){this.links=this.links.filter(e=>e.id!==t),this.saveData(),this.render()}render(){var e;if(!this.container)return;let t=`
      <div class="grid grid-cols-2 gap-3 mb-4">
    `;this.links.forEach(s=>{t+=`
        <div class="relative group">
          <a href="${s.url}" target="_blank" class="flex items-center gap-3 p-3 bg-slate-50 hover:bg-primary-50 border border-slate-100 hover:border-primary-100 rounded-xl transition-all cursor-pointer">
            <div class="w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center shrink-0 border border-slate-100">
              <i data-lucide="${s.icon}" class="w-4 h-4 ${s.color}"></i>
            </div>
            <span class="text-sm font-medium text-slate-700 truncate">${this.escapeHTML(s.title)}</span>
          </a>
          ${s.custom?`
          <button class="absolute -top-2 -right-2 bg-white rounded-full p-1 border border-slate-200 text-slate-400 hover:text-red-500 opacity-0 group-hover:opacity-100 shadow-sm transition-all" data-delete-id="${s.id}">
            <i data-lucide="x" class="w-3 h-3"></i>
          </button>
          `:""}
        </div>
      `}),t+=`
      </div>
      <div class="mt-4 pt-4 border-t border-slate-100">
        <p class="text-xs text-slate-500 mb-2 font-medium">リンクを追加</p>
        <div class="flex flex-col gap-2">
          <input type="text" id="link-title" placeholder="サイト名" class="w-full rounded-lg border-slate-200 text-sm p-2 border outline-none focus:border-primary-500">
          <div class="flex gap-2">
            <input type="url" id="link-url" placeholder="URL (https://...)" class="flex-1 rounded-lg border-slate-200 text-sm p-2 border outline-none focus:border-primary-500">
            <button id="btn-add-link" class="bg-slate-800 hover:bg-slate-900 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors shrink-0">
              追加
            </button>
          </div>
        </div>
      </div>
    `,this.container.innerHTML=t,window.lucide&&window.lucide.createIcons({root:this.container}),(e=this.container.querySelector("#btn-add-link"))==null||e.addEventListener("click",()=>{const s=this.container.querySelector("#link-title").value.trim(),o=this.container.querySelector("#link-url").value.trim();this.addLink(s,o)}),this.container.querySelectorAll("[data-delete-id]").forEach(s=>{s.addEventListener("click",o=>{this.deleteLink(o.currentTarget.dataset.deleteId)})})}escapeHTML(t){return t.replace(/[&<>'"]/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[e]||e)}}class T{constructor(t,e){this.container=document.getElementById(t),this.dataSource="data/lessons.json",this.settings=e,this.loadData()}get limit(){var t,e;return((e=(t=this.settings)==null?void 0:t.settings)==null?void 0:e.lessonsLimit)||4}async loadData(){try{const t=await fetch(this.dataSource);if(!t.ok)throw new Error("Data not found");const e=await t.json();this.lessons=e,this.render()}catch{this.container&&(this.container.innerHTML='<p class="text-slate-500 text-sm py-4 col-span-full">授業データが見つかりません。Markdownから変換スクリプトを実行してください。</p>')}}render(){if(!this.container||!this.lessons)return;if(!this.lessons.length){this.container.innerHTML='<p class="text-slate-500 text-sm py-4 col-span-full">授業データがありません。</p>';return}const t=this.lessons.slice(0,this.limit);let e="";t.forEach(s=>{const o=(s.tags||[]).slice(0,2).map(a=>`<span class="px-2 py-0.5 bg-primary-50 text-primary-600 rounded-full text-[10px] font-medium">${this.escapeHTML(a)}</span>`).join("");e+=`
        <a href="${s.url}" class="block p-4 bg-slate-50 hover:bg-primary-50 border border-slate-100 hover:border-primary-100 rounded-xl transition-all group flex flex-col h-full cursor-pointer">
          <div class="flex justify-between items-start mb-2">
            <div class="flex flex-wrap gap-1">${o}</div>
            <div class="text-[10px] text-slate-400 font-medium">${this.escapeHTML(s.date)}</div>
          </div>
          <h3 class="text-sm font-bold text-slate-800 group-hover:text-primary-600 transition-colors mb-1 line-clamp-1">${this.escapeHTML(s.title)}</h3>
          <p class="text-xs text-slate-500 line-clamp-2 mt-auto">${this.escapeHTML(s.summary)}</p>
        </a>
      `}),this.container.innerHTML=e}escapeHTML(t){return t.replace(/[&<>'"]/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[e]||e)}}class B{constructor(){this.storageKey="class-portal-settings",this.defaultSettings={themeColor:"#0ea5e9",wallpaperMode:"pattern",wallpaperImage:"",wallpaperColor:"#f8fafc",portalTitle:"学習ポータル",cardOpacity:90,fontSize:"md",timetableDays:5,timetablePeriods:6,showPeriodTimes:!1,periodTimes:[{start:"08:50",end:"09:40"},{start:"09:50",end:"10:40"},{start:"10:50",end:"11:40"},{start:"13:00",end:"13:50"},{start:"14:00",end:"14:50"},{start:"15:00",end:"15:50"},{start:"16:00",end:"16:50"}],lessonsLimit:4,widgetVisibility:{timetable:!0,lessons:!0,calendar:!0,todo:!0,links:!0}},this.settings=this.loadData(),this.applySettings()}loadData(){const t=localStorage.getItem(this.storageKey),e={...this.defaultSettings};if(!t)return e;const s=JSON.parse(t);return{...e,...s,periodTimes:s.periodTimes||e.periodTimes,widgetVisibility:{...e.widgetVisibility,...s.widgetVisibility||{}}}}saveData(){localStorage.setItem(this.storageKey,JSON.stringify(this.settings)),this.applySettings()}updateSetting(t,e){this.settings[t]=e,this.saveData()}hexToRgb(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}adjustColor(t,e){return"#"+t.replace(/^#/,"").replace(/../g,s=>("0"+Math.min(255,Math.max(0,parseInt(s,16)+e)).toString(16)).substr(-2))}applySettings(){const t=this.settings,e=document.body;let s=document.getElementById("dynamic-theme-styles");s||(s=document.createElement("style"),s.id="dynamic-theme-styles",document.head.appendChild(s));const o=(t.cardOpacity/100).toFixed(2);s.innerHTML=`
      :root {
        --tw-color-primary-500: ${t.themeColor};
        --tw-color-primary-600: ${this.adjustColor(t.themeColor,-20)};
        --tw-color-primary-50: ${this.adjustColor(t.themeColor,90)};
        --tw-color-primary-100: ${this.adjustColor(t.themeColor,80)};
      }
      .bg-primary-500 { background-color: var(--tw-color-primary-500) !important; }
      .bg-primary-600 { background-color: var(--tw-color-primary-600) !important; }
      .bg-primary-50  { background-color: var(--tw-color-primary-50)  !important; }
      .bg-primary-100 { background-color: var(--tw-color-primary-100) !important; }
      .hover\\:bg-primary-50:hover  { background-color: var(--tw-color-primary-50)  !important; }
      .hover\\:bg-primary-100:hover { background-color: var(--tw-color-primary-100) !important; }
      .hover\\:bg-primary-700:hover { background-color: var(--tw-color-primary-600) !important; filter: brightness(0.9); }
      .text-primary-500 { color: var(--tw-color-primary-500) !important; }
      .text-primary-600 { color: var(--tw-color-primary-600) !important; }
      .hover\\:text-primary-600:hover { color: var(--tw-color-primary-600) !important; }
      .border-primary-500 { border-color: var(--tw-color-primary-500) !important; }
      .border-primary-100 { border-color: var(--tw-color-primary-100) !important; }
      .focus\\:border-primary-500:focus { border-color: var(--tw-color-primary-500) !important; }
      section { background-color: rgba(255,255,255,${o}) !important; backdrop-filter: blur(8px); }
      #main-header { background-color: rgba(255,255,255,${Math.min(1,parseFloat(o)+.1).toFixed(2)}) !important; }
      ${t.fontSize==="sm"?"html { font-size: 14px; }":""}
      ${t.fontSize==="md"?"html { font-size: 16px; }":""}
      ${t.fontSize==="lg"?"html { font-size: 18px; }":""}
    `,t.wallpaperMode==="image"&&t.wallpaperImage?(e.style.backgroundImage=`url(${t.wallpaperImage})`,e.style.backgroundSize="cover",e.style.backgroundPosition="center",e.style.backgroundAttachment="fixed",e.style.backgroundColor=""):t.wallpaperMode==="color"?(e.style.backgroundImage="none",e.style.backgroundColor=t.wallpaperColor||"#f8fafc"):(e.style.backgroundImage="radial-gradient(var(--tw-color-primary-100) 1px, transparent 1px)",e.style.backgroundSize="20px 20px",e.style.backgroundColor="#f8fafc");const a=document.querySelector("#main-header h1");a&&(a.textContent=t.portalTitle||"学習ポータル"),document.title=(t.portalTitle||"学習ポータル")+" - Dashboard";const i=t.widgetVisibility||{},d={timetable:"#card-timetable",lessons:"#section-lessons",calendar:"#section-calendar",todo:"#section-todo",links:"#section-links"};for(const[c,l]of Object.entries(d)){const u=document.querySelector(l);u&&(u.style.display=i[c]!==!1?"":"none")}}}const m=new B,g=new k("timetable-container",m),w=new S("calendar-container"),D=new L("todo-list","todo-input","btn-add-todo"),j=new $("links-container"),C=new T("lessons-container",m);document.getElementById("btn-edit-timetable").addEventListener("click",r=>{g.toggleEdit(),r.target.textContent=g.isEditing?"完了":"編集"});const p=document.getElementById("settings-modal");document.querySelectorAll(".settings-tab").forEach(r=>{r.addEventListener("click",()=>{const t=r.dataset.tab;document.querySelectorAll(".settings-tab").forEach(e=>{const s=e.dataset.tab===t;e.classList.toggle("bg-white",s),e.classList.toggle("shadow-sm",s),e.classList.toggle("text-primary-600",s),e.classList.toggle("text-slate-500",!s)}),document.querySelectorAll(".settings-panel").forEach(e=>{e.classList.toggle("hidden",e.id!==`tab-${t}`)}),t==="colors"&&M()})});document.querySelectorAll(".color-preset").forEach(r=>{r.addEventListener("click",()=>{document.getElementById("s-color").value=r.dataset.color})});document.getElementById("s-bg-mode").addEventListener("change",r=>{document.getElementById("s-bg-color-row").classList.toggle("hidden",r.target.value!=="color"),document.getElementById("s-bg-image-row").classList.toggle("hidden",r.target.value!=="image")});document.getElementById("s-opacity").addEventListener("input",r=>{document.getElementById("s-opacity-val").textContent=r.target.value});document.addEventListener("change",r=>{r.target.id==="s-tt-periods"&&E(m.settings.periodTimes)});document.getElementById("s-bg-file").addEventListener("change",r=>{const t=r.target.files[0];if(t){const e=new FileReader;e.onload=s=>{document.getElementById("s-bg-url").value=s.target.result},e.readAsDataURL(t)}});function E(r){var o;const t=document.getElementById("s-period-times-list"),e=parseInt(((o=document.getElementById("s-tt-periods"))==null?void 0:o.value)||6);let s="";for(let a=0;a<e;a++){const i=r[a]||{start:"",end:""};s+=`
      <div class="flex items-center gap-2 text-sm">
        <span class="text-slate-500 w-8 text-right shrink-0">${a+1}限</span>
        <input type="time" class="period-time-start flex-1 border border-slate-200 rounded-lg px-2 py-1 text-sm outline-none focus:border-primary-500" value="${i.start}" data-idx="${a}">
        <span class="text-slate-400">〜</span>
        <input type="time" class="period-time-end flex-1 border border-slate-200 rounded-lg px-2 py-1 text-sm outline-none focus:border-primary-500" value="${i.end}" data-idx="${a}">
      </div>
    `}t.innerHTML=s}function M(){const r=document.getElementById("subject-colors-list"),t=g.getAllSubjects();if(!t.length){r.innerHTML='<p class="text-sm text-slate-400 text-center py-4">時間割に科目を登録すると、ここに表示されます。</p>';return}let e="";t.forEach(s=>{const o=g.getSubjectColor(s);e+=`
      <div class="flex items-center gap-3 py-2 border-b border-slate-100">
        <div class="w-5 h-5 rounded-md border border-slate-200 shrink-0" style="background-color:${o}"></div>
        <span class="flex-1 text-sm font-medium text-slate-700">${s}</span>
        <input type="color" class="subject-color-input h-8 w-16 rounded border border-slate-200 cursor-pointer" value="${o}" data-subject="${s}">
      </div>
    `}),r.innerHTML=e,r.querySelectorAll(".subject-color-input").forEach(s=>{s.addEventListener("change",o=>{g.setSubjectColor(o.target.dataset.subject,o.target.value)})})}function O(){var e;const r=m.settings;document.getElementById("s-portal-title").value=r.portalTitle||"",document.getElementById("s-color").value=r.themeColor,document.getElementById("s-bg-mode").value=r.wallpaperMode,document.getElementById("s-bg-color").value=r.wallpaperColor||"#f8fafc",document.getElementById("s-bg-color-row").classList.toggle("hidden",r.wallpaperMode!=="color"),document.getElementById("s-bg-image-row").classList.toggle("hidden",r.wallpaperMode!=="image"),document.getElementById("s-bg-url").value=(e=r.wallpaperImage)!=null&&e.startsWith("http")?r.wallpaperImage:"",document.getElementById("s-opacity").value=r.cardOpacity,document.getElementById("s-opacity-val").textContent=r.cardOpacity,document.getElementById("s-tt-days").value=r.timetableDays,document.getElementById("s-tt-periods").value=r.timetablePeriods,document.getElementById("s-tt-showtimes").checked=r.showPeriodTimes,document.querySelector(`input[name="s-fontsize"][value="${r.fontSize}"]`).checked=!0,document.getElementById("s-lessons-limit").value=r.lessonsLimit;const t=r.widgetVisibility||{};document.getElementById("w-timetable").checked=t.timetable!==!1,document.getElementById("w-lessons").checked=t.lessons!==!1,document.getElementById("w-calendar").checked=t.calendar!==!1,document.getElementById("w-todo").checked=t.todo!==!1,document.getElementById("w-links").checked=t.links!==!1,E(r.periodTimes),p.classList.remove("hidden"),window.lucide&&lucide.createIcons({root:p})}document.getElementById("btn-settings").addEventListener("click",O);document.getElementById("btn-close-settings").addEventListener("click",()=>p.classList.add("hidden"));p.addEventListener("click",r=>{r.target===p&&p.classList.add("hidden")});document.getElementById("btn-save-settings").addEventListener("click",()=>{const r=[...m.settings.periodTimes];document.querySelectorAll(".period-time-start").forEach(t=>{const e=parseInt(t.dataset.idx);r[e]||(r[e]={start:"",end:""}),r[e].start=t.value}),document.querySelectorAll(".period-time-end").forEach(t=>{const e=parseInt(t.dataset.idx);r[e]||(r[e]={start:"",end:""}),r[e].end=t.value}),Object.assign(m.settings,{portalTitle:document.getElementById("s-portal-title").value||"学習ポータル",themeColor:document.getElementById("s-color").value,wallpaperMode:document.getElementById("s-bg-mode").value,wallpaperColor:document.getElementById("s-bg-color").value,wallpaperImage:document.getElementById("s-bg-url").value,cardOpacity:parseInt(document.getElementById("s-opacity").value),timetableDays:parseInt(document.getElementById("s-tt-days").value),timetablePeriods:parseInt(document.getElementById("s-tt-periods").value),showPeriodTimes:document.getElementById("s-tt-showtimes").checked,periodTimes:r,fontSize:document.querySelector('input[name="s-fontsize"]:checked').value,lessonsLimit:parseInt(document.getElementById("s-lessons-limit").value),widgetVisibility:{timetable:document.getElementById("w-timetable").checked,lessons:document.getElementById("w-lessons").checked,calendar:document.getElementById("w-calendar").checked,todo:document.getElementById("w-todo").checked,links:document.getElementById("w-links").checked}}),m.saveData(),g.render(),w.render(),j.render(),D.render(),C.render(),p.classList.add("hidden")});document.getElementById("btn-reset-settings").addEventListener("click",()=>{Object.assign(m.settings,m.defaultSettings),m.saveData(),g.render(),w.render(),p.classList.add("hidden")});lucide.createIcons();
